--- buggy+++ fixed@@ -1532,7 +1532,7 @@         return true;
       assert(ID.Kind == ValID::t_MDNode);
       if (ID.MDNodeVal->isFunctionLocal())
-        return TokError("unexpected function-local metadata");
+        return Error(Loc, "unexpected function-local metadata");
       Inst->setMetadata(MDK, ID.MDNodeVal);
     } else {
       unsigned NodeID = 0;
