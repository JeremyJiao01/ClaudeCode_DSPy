--- buggy+++ fixed@@ -526,7 +526,7 @@         NGV->setAlignment(NewAlign);
 
       // Copy over the debug info for the variable.
-      uint64_t Size = DL.getTypeSizeInBits(NGV->getValueType());
+      uint64_t Size = DL.getTypeAllocSizeInBits(NGV->getValueType());
       uint64_t FragmentOffsetInBits = Layout.getElementOffsetInBits(i);
       transferSRADebugInfo(GV, NGV, FragmentOffsetInBits, Size, NumElements);
     }
@@ -538,7 +538,7 @@     auto ElTy = STy->getElementType();
     uint64_t EltSize = DL.getTypeAllocSize(ElTy);
     unsigned EltAlign = DL.getABITypeAlignment(ElTy);
-    uint64_t FragmentSizeInBits = DL.getTypeSizeInBits(ElTy);
+    uint64_t FragmentSizeInBits = DL.getTypeAllocSizeInBits(ElTy);
     for (unsigned i = 0, e = NumElements; i != e; ++i) {
       Constant *In = Init->getAggregateElement(i);
       assert(In && "Couldn't get element of initializer?");
