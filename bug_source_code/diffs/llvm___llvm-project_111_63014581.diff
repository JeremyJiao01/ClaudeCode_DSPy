--- buggy+++ fixed@@ -1527,10 +1527,12 @@     I0->getOperandUse(O).set(NewOperands[O]);
   I0->moveBefore(&*BBEnd->getFirstInsertionPt());
 
-  // Update metadata.
+  // Update metadata and IR flags.
   for (auto *I : Insts)
-    if (I != I0)
+    if (I != I0) {
       combineMetadataForCSE(I0, I);
+      I0->andIRFlags(I);
+    }
 
   if (!isa<StoreInst>(I0)) {
     // canSinkLastInstruction checked that all instructions were used by
